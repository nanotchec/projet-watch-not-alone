// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Salon {
  id_salon Int @id @default(autoincrement())
  code_partage String
  nom String
  id_participation_hote Participation? @relation(fields: [id_participation_hoteID], references: [id_participation])
  id_participation_hoteID Int @unique
  etat_lecture String
  fournisseur String
  video_id String
  horodatage_sec Int
  maj_etat_le DateTime @updatedAt
  cree_le DateTime @default(now())
  id_playlist Playlist?
  id_etat EtatSalonHistorique[]
  id_banip BanIp[]
  id_ban_user BanUtilisateur[]
}

model Participation {
  id_participation Int @id @default(autoincrement())
  id_participation_hote Salon?
  id_utilisateur Utilisateur? @relation(fields: [id_utilisateurID], references: [id_utilisateur])
  id_utilisateurID Int
  pseudo String
  role String
  ip String
  rejoint_le DateTime @default(now())
  quitte_le DateTime? 
  id_message Message[]
  id_playlist Playlist[]
  id_elements ElementPlaylist[]
}

model Utilisateur {
  id_utilisateur Int @id @default(autoincrement())
  pseudo String
  email String
  mot_de_passe_hache String
  cree_le DateTime @default(now())
  modifie_le DateTime @updatedAt
  id_participation Participation[]
  id_ban_user BanUtilisateur?
}

model Message {
  id_message Int @id @default(autoincrement())
  id_participation Participation @relation(fields:[id_ParticipationID], references: [id_participation])
  id_ParticipationID Int 
  type String
  contenu String
  cree_le DateTime @default(now())
}

model Playlist {
  id_playlist Int @id @default(autoincrement())
  id_salon Salon @relation(fields: [id_salonID], references: [id_salon])
  id_salonID Int @unique    // pour l'instant il n'y a qu'une playlist par salon a voir avant la cr√©ation de la base
  cree_par Participation? @relation(fields: [id_particiaptionID], references: [id_participation]) 
  id_particiaptionID Int? @unique
  cree_le DateTime @default(now())
  id_element_playlist ElementPlaylist[]
}

model ElementPlaylist {
  id_element_playlist Int @id @default(autoincrement())
  id_playlist Playlist @relation(fields: [id_playlistID], references: [id_playlist])
  id_playlistID Int
  fournisseur String
  video_id String
  position Int
  ajoutee_par Participation @relation(fields: [ajoutee_parID], references: [id_participation])
  ajoutee_parID Int
}

model EtatSalonHistorique {
  id_eta Int @id @default(autoincrement())
  id_salon Salon @relation(fields: [id_salonID], references: [id_salon])
  id_salonID Int
  video_id String
  etat_lecture String
  horodatage_sec Int
  vitesse String
  enregistree_le DateTime @default(now())
}

model BanIp {
  id_ban Int @id @default(autoincrement())
  id_salon Salon @relation(fields: [id_salonID], references: [id_salon])
  id_salonID Int
  ip String
  expire_le DateTime
  raison String
  cree_le DateTime @default(now())
}

model BanUtilisateur {
  id_ban_user Int @id @default(autoincrement())
  id_salon Salon @relation(fields: [id_salonID], references: [id_salon])
  id_salonID Int
  id_utilisateur Utilisateur @relation(fields: [id_utilisateurID], references: [id_utilisateur])
  id_utilisateurID Int @unique
}
